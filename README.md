# Бот для голосований
Данный бот реализован на языке Go с использованием библиотеки Gin. Для работы с Tarantool использовался использовался инструмент go-tarantool. 
Для данных из файла конфигурации используется Viper.
Реализован бот для Mattermost, в котором имеется функционал создания, получения, закрытия и удаления голосований. Взаимодействие с Mattermost происходит на основе slash-комманд. Для запуска написан docker-compose.
В Makefile прописаны вариант запуска. Приложение покрыто логами для информировани и дебага.
Для логгирования использовалась Zerolog. 
## Запуск приложения:
### Использование docker-compose.
   Для сборки и запуска приложения нужно ввести в консоль команду
   ```
   make build
   ```
   или эту команду
   ```
   docker-compose up --build
   ```
## Тестирование сервиса посредством прямых запросов
### 1. Создание голосований
#### Для создания голосования необходимо выполнить запрос
```
curl -X POST http://localhost:8080/vote \
     -H "Content-Type: application/json" \
     -d '{           
       "command": "/vote",                                    
       "text": "create \"{вопрос}\" \"{вариант ответа 1}\" \"{вариант ответа 2}\" \"{вариант ответа 3}\"",
       "user_id": "{user_id}",
       "channel_id": "{channel_id}"
     }'
```
Вместо параметров в скобках вводятся соответствующие данные. Для удачного создания голосования нужны хотя бы 2 варианта ответа. В ответ выдастся ID голосования и варианты ответа. 
### 2. Получение данных о голосовании
#### Для получения данных о голосовании необходимо выполнить запрос
```
curl -X POST http://localhost:8080/vote -H "Content-Type: application/json" -d '{
  "command": "/poll",
  "text": "results  {id голосования}",
  "user_id": "{user_id}",
  "channel_id": "{channel_id}"
}'
```
Вместо параметров в скобках вводятся соответствующие данные. В ответ выдастся ID голосования, вопрос и варианты ответа вместе с количеством голосов у каждого. 
### 3. Выбор варианта в голосовании
#### Для выбора варианта в голосовании необходимо выполнить запрос
```
curl -X POST http://localhost:8080/vote -H "Content-Type: application/json" -d '{
  "command": "/poll",
  "text": "cast  {id голосования} \"{вариант ответа}\" ",
  "user_id": "{user_id}",
  "channel_id": "{channel_id}"
}'
```
Вместо параметров в скобках вводятся соответствующие данные. В случае успеха в ответ выдастся сообщение об удачном запросе. 
### 4. Завершение голосования
#### Для завершения голосования пользователю необходимо выполнить запрос
```
curl -X POST http://localhost:8080/vote -H "Content-Type: application/json" -d '{
  "command": "/poll",
  "text": "close  {id голосования}",
  "user_id": "{user_id}",
  "channel_id": "{channel_id}"
}'
```
Вместо параметров в скобках вводятся соответствующие данные. В случае успеха в ответ выдастся сообщение об удачном запросе. Только создатель может закрыть голосование.
### 5. Удаление голосования
#### Для удаления голосования пользователю необходимо выполнить запрос
```
curl -X POST http://localhost:8080/vote -H "Content-Type: application/json" -d '{
  "command": "/poll",
  "text": "delete  {id голосования}",
  "user_id": "{user_id}",
  "channel_id": "{channel_id}"
}'
```
Вместо параметров в скобках вводятся соответствующие данные. В случае успеха в ответ выдастся сообщение об удачном запросе. Только создатель может удалить голосование.
## Обработка ошибок и логгирование
Для различных методов и вызовов функций реализованы логгирование информационных сообщений и обработка ошибок, в зависимости от категории ошибки, выдается текст и код ошибки.